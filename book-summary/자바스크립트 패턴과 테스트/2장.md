## 2.1 테스팅 프레임워크
명세가 아니라 함수 코드의 개발에 따라 테스트를 작성하면 안된다.

단위 테스트가 없는 기존 코드를 작업할 땐 실제 기능을 확인하는 테스트를 작성해야 한다. 그래야 밖으로 표출되는 기능을 변경하지 않은 상태에서 코드를 리팩토링할 수 있다.

### 2.1.1 잘못된 코드 발견하기
배열 데이터를 받아 많은 계싼을 수행하는 함수를 개발한다고 치자.

처음부터 간단하게라도 계산 단계와 배열 원소에 대해 테스트를 작성하여 검증하면 훨씬 더 빨리 한끗차이 에러를 솎아내고 다음 업무로 넘어갈 수 있다.

### 2.1.2 테스트성을 감안하여 설계하기
테스트성을 설계 목표로 정하면 SOLID한 코드를 작성할 수 있다.

### 2.1.3 꼭 필요한 코드만 작성하기
작은 기능 하나를 검증하려면 실패하는 테스트를 먼저 작성한 뒤, 테스트를 성공시킬 만큼만 최소한으로 코딩한다.

최소한의 코드를 넣은 다음 리팩토링으로 중복 코드를 없애고... 결국 꼭 필요한 코드만 살아남게 된다.

### 2.1.4 안전한 유지 보수와 리팩토링
종합적인 단위 테스트 꾸러미가 마련된 제품 코드를 확장 또는 보수할 때 안도감을 느낄 수 있다.

### 2.1.5 실행 가능한 명세
탄탄하게 구축된 단위 테스트 꾸러미는 테스트 대상 코드의 실행 가능한 명세 역할도 한다.

### 2.1.6 최신 오픈 소스 및 상용 프레임워크
재스민, QUnit, D.O.H, Jest

### 2.1.7 재스민 들어가기
재스민은 행위 주도 개발(BDD) 방식으로 자바스크립트 단위 테스트를 작성하기 위한 라이브러리다.
> BDD: BDD는 TDD와 상호 배타 관계가 아니다. BDD는 단위 테스트로 확인할 긴으 또는 작동 로직을 일상 언어로 서술하는데, 이로써 개발자는 자신이 작성 중인 코드가 '어떻게'가 아니라 '무엇'을 해야 하는지 테스트 코드에 표현할 수 있다. 그리고 행위 주도 스타일로 정의/구성한 테스트는 쉬운 문장으로 서술한 기능 명세서로 삼을 만하다는 이점도 있다.

#### 테스트 꾸러미와 스펙
재스민 테스트 꾸러미는 전역 함수 **describe**로 정의되며, 이 함수는 두 인자를 받는다.
- 문자열: 무엇을 테스트할지 서술한다.
- 함수: 테스트 꾸러미의 구현부다.

테스트 꾸러미는 스펙, 즉 개별 테스트로 구현되며, 각 스펙은 전역 함수 **it**으로 정의된다. it 함수도 describe 함수처럼 인자를 2개 받는다.
- 문자열: 무엇을 테스트할지 서술한다.
- 적어도 한 개의 기대식을 가진 함수: 코드 상태의 true/false를 확인하는 단언

테스트 꾸러미 구현부에 전역 함수 **beforeEach/afterEach**를 쓰면 각 꾸러미 테스트가 실행되기 이전에 beforeEach 함수를, 그 이후에는 afterEach 함수를 호출한다.

> 테스트 꾸러미 역시 SOLID하고 DRY해야 한다!

#### 기대식과 매처
- expect 문은 테스트마다 있다.
- 하나 이상의 기대식이 포함된 스펙에서 매처가 하나라도 실패하면 모조리 실패한 거로 간주한다.
- toBe 매처는 같은 객채여야 한다는 의미다.
> 용도에 맞는 매처가 없으면 재스민이 지원하는 커스텀 매처를 만들어 쓰자.

#### 스파이
스파이는 테스트 더블 역할을 하는 자바스크립트 함수다.

*테스트 더블*
- 어떤 함수/객체의 본래 구현부를 테스트 도중 다른(보통은 더 간단한) 코드로 대체한 것을 말한다.
- 웹 서비스 같은 외부 자원과의 의존 관계를 없애고 단위 테스트의 복잡도를 낮출 목적으로 사용된다.

*테스트 더블의 종류*
- 더미(dummy): 보통 인자 리스트를 채우기 위해 사용되며, 전달은 하지만 실제로 사용되지는 않는다.
- 틀(stub):더미를 조금 더 구현하여 아직 개발되지 않은 클래스나 메서드가 실제 작동하는 것처럼 보이게 만든 객체로 보통 리턴값은 하드 코딩한다.
- 스파이(spy): 틀과 비슷하지만 내부적으로 기록을 남긴다는 점이 다르다. 특정 객체가 사용되었는지, 예상되는 메서드가 특정한 인자로 호출되었는지 등의 상황을 감시하고 이러한 정보를 제공하기도 한다.
- 모의체(fake): 틀에서 조금 더 발전하여 실제로 간단히 구현된 코드를 갖고는 있지만, 운영 환경에서 사용할 수는 없는 객체다.
- 모형(mock): 더미, 틀, 스파이를 혼합한 형태와 비슷하나 행위를 검증하는 용도로 주로 사용된다.

